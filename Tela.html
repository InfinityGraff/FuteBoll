<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Tel√£o - Placar</title>
    <link  href="./MyBiblioteca/CSSBiblioteca.css" rel="stylesheet">
    <script src="./MyBiblioteca/PreScript.js"></script>
    <script src="./MyBiblioteca/PrepDrop.js" ></script>

    <script src="https://unpkg.com/@supabase/supabase-js"></script>
    <script> // Base de Dados
      const SUPABASE_URL      = "https://adxigvfxtafvlmpvwwvb.supabase.co"
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkeGlndmZ4dGFmdmxtcHZ3d3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1Njc1NTEsImV4cCI6MjA2NzE0MzU1MX0.wc90qDuSNhtolJBd4qLEux3xCwJwPuTTFb3gZMKUBYU"
      const supabase          =  window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
      const BASE_URL          = `https://adxigvfxtafvlmpvwwvb.supabase.co/storage/v1/object/public/Jogo/Imgs`
    </script>
    <script src="./SupaBASE.js"></script>
</head>

<style>
  :root{--accent:#0ea5e9;--panel:#071b33b2;--panel-2:#102a4a;--glass:#ffffff0a;--muted:#ffffffb3}
  *          {margin:0;padding:0;font-family:Montserrat,system-ui,Arial;font-weight:bold}
  html,body  {height:100%;width:100%}
  body       {padding:2% 3% 3% 3%;background-image:url(./Imgs/Fundo.webp); background-size:100% 100%;background-repeat:no-repeat;background-position:top left}
  .Live p    {color:#ffffff; font-size:3rem}
  .Live a    {background:red; width:15px; height:15px; margin-right:5px}
  header     {gap:12px; z-index:2} header > *{font-size:5rem}
    .tab     {width: 600px;flex:1 1 0;background:linear-gradient(0deg,var(--panel),var(--panel-2));color:#fff;padding:14px 18px;text-align:center;letter-spacing:1px;position:relative;box-shadow:0 6px 18px #02061773}
    .TxtLmt  {white-space: nowrap;overflow: hidden;text-overflow: ellipsis}
    .tab.tA::before,.tab.tB::after{content:'';position:absolute;top:0;width:18px;height:100%;transform:translateY(0);background:linear-gradient(180deg,#ff9b2b,#ff5a5a)}
    .tab.tA::before{left:-1px;}.tab.tB::after{right:-1px;}

  .Painel    {z-index:2; margin-top: 20px ;height: 550px ; padding:10px 10px;background:linear-gradient(180deg,#ffffff08,#ffffff03);gap:18px;box-shadow:0 14px 30px #040c1e80;color:var(--muted);backdrop-filter:blur(6px)}
  #T_A {flex:1 1 150px; order:1}.Score{order:2}#T_B {flex:1 1 150px; order:3}

  .box          {padding:30px 50px;transition:transform 0.2s;min-width:200px;text-align:center ; margin-bottom: 50px;}
  .Score        {padding-bottom:100px ; transform: scaleY(1.2)}
  #Tempo        {bottom:0px}
  .box img      {width:350px;height:350px;object-fit:contain;margin:8px}
  .box > div >p {font-size:7rem ; text-shadow:0 5px 5px #0000009c; color:#ffffff ; display: none;}
  .Score > *    {font-size:23rem; text-shadow:0 5px 5px #0000009c; color:#ffffff ; margin:0px 10px}  .vs{opacity:0.7}
  #Tempo > *    {font-size:7rem ; text-shadow:0 5px 5px #0000009c; color:#ffffff ;z-index:2 ; padding:10px 20px; display:inline-flex; align-items:center; gap:12px}
  #Tempo > a    {font-size:7rem ; color:#ffbb00}

  .Evn{display:none;gap:8px;font-size:14px;color:#ffffffbf;max-width:360px;margin-top:15px}
  .Evn a{display:flex;gap:10px;align-items:center}
  .Evn p{width:40px;text-align:left;color:var(--accent)}
  .Evn b{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:start}

  .gol-anim{z-index:3;position:fixed;top:0;left:0;right:0;bottom:0;background:#16161623;display:flex;justify-content:center;align-items:center;font-size:80px;font-weight:900;color:#28a745;opacity:0;animation:golAnim 7s ease forwards
    ;text-shadow:0 8px 8px #000000ec
    ;backdrop-filter: blur(8px)
  }
  @keyframes golAnim {0%{opacity:0;transform:scale(0.5)}20%{opacity:1;transform:scale(1.3)}80%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(1)}}
</style>

<body class="Cl Rltv">
  <div style="top:15px" class="Abslt Rd Live Hov Ct none"><a class="Rd"></a><p>Ao Vivo</p></div>
  <header class="Bt"><a class="tab TxtLmt tA Hov rd">Time A</a><p>üÜö</p><a class="tab TxtLmt tB Hov rd">Time B</a></header>
  <div class="Painel Ct w100 Rltv rd">
      <div class="box Hov Cl" id="T_A"><div class="Ct"><div id="Img_A"></div><p>Time A</p></div><div class="Evn Start2"></div></div>
      <div class="Ev Score"><a id="Gol_A">0</a><div class="vs">-</div><a id="Gol_B">0</a></div>
      <div class="box Hov Cl" id="T_B"><div class="Ct"><div id="Img_B"></div><p>Time B</p></div><div class="Evn Start2"></div></div>
      <div id="Tempo" class="Abslt Ct"><p>1¬∞ Tempo</p><a>00:00</a></div>
  </div>
  <div style="bottom:15px" class="Abslt imgFund"><img src="./Imgs/Campo.webp"></div>
</body>

<script>
  function Pegaai(e){
    const H = e.Hist_A.filter(x=>x.Ev=='Ply'||x.Ev=='Stp')
    if(!H.length){return '00:00'}
    const L = H.at(-1)
    if(L.Ev=='Stp'){return L.Minuto}
    if(L.Ev=='Ply'){    
      const F=s=>`${(s/60|0).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`
      const Diff = new Date() - new Date(`${YMD(L.Dia)}T${L.Hora}`)
      const Dif = ((Diff) / 1e3)|0
      LOG(Dif)
      Inn($('#Tempo a'),F(Dif))
      Timer($('#Tempo a'),'Ply',Dif,false,e=>{CallBack('New')})
    }
    //return F(Dif)
  }


  const Exibir=(e,First)=>{
    if(e.Stts=='End'){return}
    //Trexo da Configura√ß√£o do JOGO
      Inn('header .tA',e.Tim_A) ; Inn('#T_A p',e.Tim_A) ; Inn('#Img_A',e.Img_A ?`<img src="${BASE_URL}/${e.Img_A}?v=${Date.now()}">`:'')
      Inn('header .tB',e.Tim_B) ; Inn('#T_B p',e.Tim_B) ; Inn('#Img_B',e.Img_B ?`<img src="${BASE_URL}/${e.Img_B}?v=${Date.now()}">`:'')
      Inn('#Tempo   p',e.Tempo) ; if(First=='First'){Inn('#Tempo a',Pegaai(e))}
      
    //Trexo de Atualiza√ß√µes de Eventos
      const Ev_A = [{min:12,Play:"JoseMonteiro"},{min:32,Play:"Fernandinho"},{min:45,Play:"Bruno"},{min:78,Play:"Felipe"}]
      const Ev_B = [{min:12,Play:"JoseMonteiro"},{min:32,Play:"Fernandinho"},{min:45,Play:"Bruno"},{min:78,Play:"Felipe"}] 
      Inn('#Gol_A', e.Gol_A) ; Inn($('#T_A .Evn'),Ev_A.map(e=>`<a><p>${e.min}</p><b>${e.Play}</b></a>`).join(''))
      Inn('#Gol_B', e.Gol_B) ; Inn($('#T_B .Evn'),Ev_B.map(e=>`<a><p>${e.min}</p><b>${e.Play}</b></a>`).join(''))
  }

  function Anima(e){
      const Stg = {
        Gol:e=>`‚öΩÔ∏è GOOOOL          <br> DO ${AA(e)}!`,
     '-Gol':e=>`‚ùå‚öΩ Gol Impedido <br> do ${e}`,
        Amr:e=>`üü® Cart√£o Amarelo  <br> do ${e}`,
        Red:e=>`üü• Cart√£o Vermelho <br> do ${e}`,
        Flt:e=>`‚ùå Falta           <br> do ${e}`,
        Sub:e=>`üîÑ Subistitui√ß√£o   <br> do ${e}`,
        Cnf:e=>`Aguardando`,
        Ply:e=>`Jogo Iniciado`,
        Stp:e=>`Intervalo`,
        End:e=>`Jogo Encerrado`,
      }
      if(!Stg[e.Ev[0]]){return} // n√£o fazer nada caso n√£o exista aqui Dentro!
      const d=NewTag('div')
      d.className='gol-anim'
      d.innerHTML=Stg[e.Ev[0]](e[`Tim_${e.Ev[1]}`])
      document.body.appendChild(d)
      setTimeout(()=>d.remove(),3000)
  }

  supabase.channel('placar').on('postgres_changes',{event:'*',schema:'public',table:'placar'},e=>{
    const New = e.new
    Anima(New) ; Exibir(New)
    if(New.Ev[0]=='Ply'){Timer($('#Tempo a'),'Ply',ToSec(New.Ev[1]),false,e=>{CallBack(New)})}
    if(New.Ev[0]=='Stp'){Timer($('#Tempo a'),'Stp',ToSec(New.Ev[1]),false,e=>{CallBack(New)})}
    if(New.Ev[0]=='End'){Timer($('#Tempo a'),'End',ToSec(New.Ev[1]),false,e=>{CallBack(New)})}
  }).subscribe()
  function CallBack(e){/*LOG('Callnack',e)*/}
  async function iniciar(){
    let data = await GetSB() ; if(data){Exibir(data,'First')}
     // depois ver a id√©ia da Nova Linha pois se eu adicionar uma Nova Linha l√°, essa p√°gina ainda vai ficar com o ultimo, q seria mais antigo
  }
  iniciar()
</script>
</html>